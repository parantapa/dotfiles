#!/usr/bin/env python2
# encoding: utf-8
"""
Watch xscreensaver and turn off volume when on.
"""

from __future__ import print_function

from subprocess import Popen, PIPE, STDOUT, call

def main():
    cmd = "xscreensaver-command -watch"
    proc = Popen(cmd, shell=True, stdout=PIPE, stderr=STDOUT)

    # NOTE: As of today (July 20, 2015) we can't use
    # ``for line in proc.stdout'' here because of the following bug
    # http://bugs.python.org/issue3907
    for line in iter(proc.stdout.readline, ""):
        line = line.strip()

        if line.startswith("BLANK") or line.startswith("LOCK"):
            cmd = "sound-ctrl mute"
            call(cmd, shell=True)

if __name__ == '__main__':
    main()
