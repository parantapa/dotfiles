#!/usr/bin/env python
"""
Parse the output of scontrol show job.
"""

import sys
import json

def usage():
    """
    Print usage.
    """

    print("Usage: scontrol show job <jobid> | scontrol-show-job-parse [KEY]")

def parse_scontrol_show_job(output):
    """
    Parse scontrol output.
    """

    lines = output.strip().split("\n")
    lines = [line.strip() for line in lines]
    lines = [line for line in lines if line]
    lines = [line.split() for line in lines]

    words = [word for ws in lines for word in ws]

    kvs = [word.split("=", 1) for word in words]
    kvs = dict(kvs)

    return kvs

def main():
    """
    Parse output.
    """

    kvs = parse_scontrol_show_job(sys.stdin.read())

    if len(sys.argv) == 1:
        print(json.dumps(kvs, indent=2, sort_keys=True))
        sys.exit(0)

    if len(sys.argv) == 2:
        key = sys.argv[1]
        if key == "--help":
            usage()
            sys.exit(0)

        if key not in kvs:
            sys.exit(1)

        print(kvs[key])
        sys.exit(0)

    usage()
    sys.exit(1)

if __name__ == "__main__":
    main()
