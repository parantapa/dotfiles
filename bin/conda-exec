#!/bin/bash

_usage () {
    echo "Usage: export CONDA_ROOT=/path/to/anaconda/install"
    echo "       export CONDA_ENV=conda-env-to-use"
    echo "       ./conda-run.sh COMMAND [ARGS]"
}

if [[ -z "$@" ]] ; then
    _usage
    exit 1
fi
if [[ "$@" == "--help" ]] ; then
    _usage
    exit 0
fi
if [[ -z "$CONDA_ROOT" ]] ; then
    echo "conda-exec: \$CONDA_ROOT not defined"
    exit 1
fi
if [[ -z "$CONDA_ENV" ]] ; then
    echo "conda-exec: \$CONDA_ENV not defined"
    exit 1
fi

. "$CONDA_ROOT/etc/profile.d/conda.sh"
conda activate "$CONDA_ENV"

if [[ -n "$CONDA_EXEC_DEBUG" ]] ; then
    echo "CONDA_ROOT='$CONDA_ROOT'"
    echo "CONDA_ENV='$CONDA_ENV'"
    echo "Command: '$@'"
fi

exec "$@"
