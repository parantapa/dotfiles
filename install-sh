#!/bin/bash

srcdir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd -P )"
if [[ -d "$1" ]] ; then
    dstdir="$1"
    shift 1
else
    dstdir="$HOME"
fi

dotfiles=(profile bash_logout
    tmux.conf gitconfig hgrc cvsignore
    ackrc ctags sqliterc psqlrc)

dotfiles_extra=(gvimrc vim/bundle vim/python2 vim/syntax
    pylintrc bowerrc i3/config.global config/dunstrc gtkrc-2.0)

cd "$dstdir"

# Dont overwrite bashrc
if [[ ! -r .bashrc ]] ; then
    \cp -i "$srcdir/bashrc" ".bashrc"
fi
if [[ ! -r .vimrc ]] ; then
    \cp -i "$srcdir/vimrc" ".vimrc"
fi

[[ -d .vim ]]            || mkdir .vim
[[ -d .vim/tmp ]]        || mkdir .vim/tmp
[[ -d .vim/tmp/backup ]] || mkdir .vim/tmp/backup
[[ -d .vim/tmp/undo ]]   || mkdir .vim/tmp/undo
[[ -d .vim/tmp/swap ]]   || mkdir .vim/tmp/swap

for file in "${dotfiles[@]}" ; do
    ln -siT "$srcdir/$file" ".$file"
done
ln -siT "$srcdir/profile" ".bash_profile"


if [[ "$1" == "--extra" ]] ; then
    [ -d .i3 ]     || mkdir .i3
    [ -d .config ] || mkdir .config

    touch .i3/config.local
    touch .repo-dirs

    cd "$srcdir"
    git submodule sync
    git submodule update --init
fi
